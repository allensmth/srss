{% extends "base.html" %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
{% block content %}
<div class="container mx-auto p-2 md:p-4">
  <div class="bg-base-100 rounded-lg overflow-hidden mb-4 p-4">
      <div class="flex flex-wrap gap-2" id="filter-tags">
          <span class="tag active" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "all"}'>全部</span>
          <span class="tag" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "Discussion"}'>讨论</span>
          <span class="tag" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "Question"}'>问题</span>
          <span class="tag" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "Travel"}'>旅行</span>
          <span class="tag" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "Web Dev"}'>Web开发</span>
          <span class="tag" hx-get="/filter" hx-trigger="click" hx-target="#post-list" hx-swap="innerHTML" hx-vals='{"tag": "Django"}'>Django</span>
      </div>
  </div>

<div id="post-list" class="bg-base-100 rounded-lg overflow-hidden">
    {% for item in rss_items %}
    <div class="post-item p-4">
        <div class="flex items-center justify-between mb-2">
            <div class="flex items-center space-x-2">
                <span class="tag">{{ item.author }}</span>
                <span class="text-sm text-base-content/70">{{ item.created_at.strftime(' %H:%M / %m-%d') }}</span>
            </div>
            <div class="flex space-x-2">
                <span class="tag">{{ item.label }}</span>
                <span class="tag">Travel</span>
            </div>
        </div>
        <p class="text-sm">{{ item.content }}</p>
    </div>
    {% endfor %}
  
  </div>
</div>
<script>
    const socket = io();

    socket.on('new_rss', function(data) {
        const postList = document.getElementById('post-list');
        const newItem = document.createElement('div');
        newItem.className = 'post-item p-4';
        newItem.innerHTML = `
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center space-x-2">
                    <span class="tag">${data.author}</span>
                    <span class="text-sm text-base-content/70">${data.created_at}</span>
                </div>
                <div class="flex space-x-2">
                    <span class="tag">${data.label}</span>
                    <span class="tag">Travel</span>
                </div>
            </div>
            <p class="text-sm">${data.content}</p>
        `;
        postList.prepend(newItem);
    });
</script>
{% endblock content %}